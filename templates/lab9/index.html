{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='lab9/lab9.css') }}">
{% endblock %}

{% block main %}
<h1>üéÅ–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—èüéÅ</h1>

{% if auth %}
<div class="user-info">
    –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: {{ login }} | <a href="/lab9/logout">–í—ã–π—Ç–∏</a>
    <form action="/lab9/santa" method="post" class="santa-form">
        <button type="submit" class="santa-btn">üéÖ –î–µ–¥ –ú–æ—Ä–æ–∑</button>
    </form>
</div>
{% endif %}

{% if request.args.get('error') %}
<div class="error">{{ request.args.get('error') }}</div>
{% endif %}

{% if request.args.get('message') %}
<div class="success">{{ request.args.get('message') }}</div>
{% endif %}

<div class="stats">
    <p>–û—Ç–∫—Ä—ã—Ç–æ: {{ opened_count }}/3 | –û—Å—Ç–∞–ª–æ—Å—å: {{ remaining }}</p>
    {% if not auth %}
    <p><a href="/lab9/login"><i>–í–æ–π—Ç–∏</i></a> | <a href="/lab9/register"><i>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</i></a></p>
    {% endif %}
</div>

<div class="boxes-container">
    {% if boxes %}
        {% for box in boxes %}
        <div class="box-wrapper" style="top: {{ box.top }}%; left: {{ box.left }}%;">
            <div class="box {% if box.opened %}opened{% endif %}">
                {% if box.can_open %}
                <form action="/lab9/open_box" method="post">
                    <input type="hidden" name="box_id" value="{{ box.id }}">
                    <button type="submit" class="box-btn">
                        <img src="{{ box.gift_image }}" alt="–ö–æ—Ä–æ–±–∫–∞ {{ box.number }}">
                        {% if box.opened %}<span class="opened-label">‚úì</span>{% endif %}
                    </button>
                </form>
                {% else %}
                <div class="box-btn">
                    <img src="{{ box.gift_image }}" alt="–ö–æ—Ä–æ–±–∫–∞ {{ box.number }}">
                    {% if box.opened %}
                    <span class="opened-label">‚úì</span>
                    {% elif box.require_auth and not auth %}
                    <span class="lock-label">üîí</span>
                    {% endif %}
                </div>
                {% endif %}
                <div class="box-number">{{ box.number }}</div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    {% endif %}
</div>

{% if last_gift %}
<div class="gift-display">
    <h3>üéâ –ö–æ—Ä–æ–±–∫–∞ ‚Ññ{{ last_gift.box_number }} –æ—Ç–∫—Ä—ã—Ç–∞!</h3>
    <p class="congrats">{{ last_gift.congratulation }}</p>
    <img src="{{ last_gift.gift_image }}" alt="–ü–æ–¥–∞—Ä–æ–∫" class="gift-img">
</div>
{% elif opened_count >= 3 %}
<div class="message">
    <p>üéä –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –≤—Å–µ 3 –∫–æ—Ä–æ–±–∫–∏!</p>
</div>
{% else %}
<div class="message">
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫</p>
</div>
{% endif %}
{% endblock %}